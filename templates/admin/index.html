{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static "admin/css/dashboard.css" %}">
<style>
    .custom-dashboard-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 20px 0;
        padding: 0 20px;
    }
    
    .custom-card {
        background: white;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        text-decoration: none;
        color: inherit;
        display: block;
        position: relative;
        overflow: hidden;
    }
    
    .custom-card:hover {
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        transform: translateY(-4px);
    }
    
    .custom-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    }
    
    .custom-card.stats-card::before {
        background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
    }
    
    .custom-card.activity-card::before {
        background: linear-gradient(90deg, #fa709a 0%, #fee140 100%);
    }
    
    .card-icon {
        font-size: 48px;
        margin-bottom: 16px;
    }
    
    .card-title {
        font-size: 20px;
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
    }
    
    .card-description {
        font-size: 14px;
        color: #666;
        line-height: 1.5;
    }
    
    .card-footer {
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid #e5e7eb;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .card-link {
        color: #667eea;
        font-weight: 500;
        font-size: 14px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 4px;
    }
    
    .card-link:hover {
        color: #764ba2;
    }
    
    .card-stats {
        display: flex;
        gap: 20px;
        margin-top: 12px;
    }
    
    .stat-item {
        display: flex;
        flex-direction: column;
    }
    
    .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #333;
    }
    
    .stat-label {
        font-size: 12px;
        color: #999;
        text-transform: uppercase;
    }
</style>
{% endblock %}

{% block coltype %}colMS{% endblock %}

{% block bodyclass %}{{ block.super }} dashboard{% endblock %}

{% block breadcrumbs %}{% endblock %}

{% block nav-sidebar %}{% endblock %}

{% block content %}
<div id="content-main">
    <h1>관리자 대시보드</h1>
    
    <!-- 커스텀 대시보드 카드 -->
    <div class="custom-dashboard-cards">
        <!-- 실시간 통계 대시보드 카드 -->
        <a href="{% url 'admin:admin_statistics' %}" class="custom-card stats-card">
            <div class="card-icon">📊</div>
            <h2 class="card-title">실시간 통계 대시보드</h2>
            <p class="card-description">일/월/년 트래픽 분석 및 사용자 활동 통계를 실시간으로 확인하세요.</p>
            <div class="card-stats">
                <div class="stat-item">
                    <span class="stat-value" id="total-users-stat">-</span>
                    <span class="stat-label">전체 사용자</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="active-today-stat">-</span>
                    <span class="stat-label">오늘 활동</span>
                </div>
            </div>
            <div class="card-footer">
                <span class="card-link">대시보드 보기 →</span>
            </div>
        </a>
        
        <!-- 사용자 활동 모니터링 카드 -->
        <a href="{% url 'admin:admin_user_activity' %}" class="custom-card activity-card">
            <div class="card-icon">👥</div>
            <h2 class="card-title">사용자 활동 모니터링</h2>
            <p class="card-description">로그인/가입 현황 및 실시간 사용자 활동 기록을 모니터링하세요.</p>
            <div class="card-stats">
                <div class="stat-item">
                    <span class="stat-value" id="online-users-stat">-</span>
                    <span class="stat-label">온라인</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="new-today-stat">-</span>
                    <span class="stat-label">신규 가입</span>
                </div>
            </div>
            <div class="card-footer">
                <span class="card-link">모니터링 보기 →</span>
            </div>
        </a>
    </div>

    {% if app_list %}
    <!-- 기본 Django Admin 앱 목록 -->
    <div class="app-list">
        {% for app in app_list %}
        <div class="app-{{ app.app_label }} module{% if app.has_perms %} has_perms{% endif %}">
            <table>
                <caption>
                    <a href="{{ app.app_url }}" class="section" title="{% blocktrans with name=app.name %}Models in the {{ name }} application{% endblocktrans %}">{{ app.name }}</a>
                </caption>
                {% for model in app.models %}
                <tr class="model-{{ model.object_name|lower }}{% if model.admin_url %} has_admin{% endif %}">
                    {% if model.admin_url %}
                        <th scope="row"><a href="{{ model.admin_url }}">{{ model.name }}</a></th>
                    {% else %}
                        <th scope="row">{{ model.name }}</th>
                    {% endif %}

                    {% if model.add_url %}
                        <td><a href="{{ model.add_url }}" class="addlink">{% trans 'Add' %}</a></td>
                    {% else %}
                        <td></td>
                    {% endif %}

                    {% if model.admin_url and show_changelinks %}
                        {% if model.view_only %}
                            <td><a href="{{ model.admin_url }}" class="viewlink">{% trans 'View' %}</a></td>
                        {% else %}
                            <td><a href="{{ model.admin_url }}" class="changelink">{% trans 'Change' %}</a></td>
                        {% endif %}
                    {% elif show_changelinks %}
                        <td></td>
                    {% endif %}
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>{% trans "You don't have permission to view or edit anything." %}</p>
    {% endif %}
</div>

<script>
// 통계 데이터 로드 (간단한 미리보기)
document.addEventListener('DOMContentLoaded', function() {
    // 통계 데이터 가져오기
    fetch('{% url "admin:admin_api_statistics_data" %}')
        .then(response => response.json())
        .then(data => {
            document.getElementById('total-users-stat').textContent = data.total_users || '0';
            document.getElementById('active-today-stat').textContent = data.active_users_today || '0';
        })
        .catch(error => {
            console.error('Failed to load stats:', error);
        });
    
    // 사용자 활동 데이터 가져오기
    fetch('{% url "admin:admin_api_user_activity_data" %}')
        .then(response => response.json())
        .then(data => {
            document.getElementById('online-users-stat').textContent = data.online_users || '0';
            document.getElementById('new-today-stat').textContent = data.recent_users ? data.recent_users.length : '0';
        })
        .catch(error => {
            console.error('Failed to load user activity:', error);
        });
});
</script>
{% endblock %}

{% block sidebar %}
<div id="content-related">
    <div class="module" id="recent-actions-module">
        <h2>{% trans 'Recent actions' %}</h2>
        <h3>{% trans 'My actions' %}</h3>
            {% load log %}
            {% get_admin_log 10 as admin_log for_user user %}
            {% if not admin_log %}
            <p>{% trans 'None available' %}</p>
            {% else %}
            <ul class="actionlist">
            {% for entry in admin_log %}
            <li class="{% if entry.is_addition %}addlink{% endif %}{% if entry.is_change %}changelink{% endif %}{% if entry.is_deletion %}deletelink{% endif %}">
                {% if entry.is_deletion or not entry.get_admin_url %}
                    {{ entry.object_repr }}
                {% else %}
                    <a href="{{ entry.get_admin_url }}">{{ entry.object_repr }}</a>
                {% endif %}
                <br>
                {% if entry.content_type %}
                    <span class="mini quiet">{{ entry.content_type }}</span>
                {% else %}
                    <span class="mini quiet">{% trans 'Unknown content' %}</span>
                {% endif %}
            </li>
            {% endfor %}
            </ul>
            {% endif %}
    </div>
</div>
{% endblock %}